# Μονάδα Διαχείρισης Αρχείων (file_handler.py)

## Επισκόπηση
Αυτή η μονάδα παρέχει βοηθητικές συναρτήσεις για τη μετατροπή συντεταγμένων σκακιέρας σε αλγεβρική σημειογραφία και την αποθήκευση του ιστορικού κινήσεων του παιχνιδιού σε αρχεία κειμένου. Χειρίζεται τη μετάφραση μεταξύ εσωτερικής αναπαράστασης σκακιέρας και ανθρώπινα αναγνώσιμης σημειογραφίας σκακιού, καθώς και τη δημιουργία μόνιμων αρχείων ολοκληρωμένων παιχνιδιών.

## Ανάλυση Γραμμή προς Γραμμή

### Εισαγωγές
```python
from datetime import datetime
```
- Εισάγει την κλάση datetime για τη διαχείριση χρονοσημάνσεων κατά την αποθήκευση παιχνιδιών

### Συνάρτηση Μετατροπής Σημειογραφίας Σκακιού
```python
def coords_to_algebraic(row, col):
    """Μετατροπή συντεταγμένων σε αλγεβρική σημειογραφία σκακιού (π.χ. e4)"""
    cols = 'abcdefgh'
    rows = '87654321'
    return cols[col] + rows[row]
```
- Μετατρέπει τις εσωτερικές συντεταγμένες σκακιέρας (γραμμή, στήλη) σε τυπική αλγεβρική σημειογραφία σκακιού
- Αντιστοιχίζει τους δείκτες στηλών (0-7) σε στήλες σκακιού (a-h)
- Αντιστοιχίζει τους δείκτες γραμμών (0-7) σε σειρές σκακιού (8-1), σημειώνοντας την αντίστροφη σειρά
- Επιστρέφει ένα συμβολοσειρά δύο χαρακτήρων όπως το "e4" που αναπαριστά τη θέση στη σκακιέρα

### Συνάρτηση Αποθήκευσης Παιχνιδιού
```python
def save_moves_to_file(moves_history, game_over=False, checkmate=False, turn=None, filename=None):
    """Αποθήκευση κινήσεων σε αρχείο κειμένου"""
    if not moves_history:
        return "Καμία κίνηση προς αποθήκευση!", False
```
- Κύρια συνάρτηση για την αποθήκευση κινήσεων του παιχνιδιού σε αρχείο κειμένου
- Λαμβάνει παραμέτρους:
  - `moves_history`: Λίστα κινήσεων σε αλγεβρική σημειογραφία
  - `game_over`: Εάν το παιχνίδι έχει τελειώσει
  - `checkmate`: Εάν το παιχνίδι τελείωσε με ρουά-ματ
  - `turn`: Ποιανού η σειρά ήταν όταν τελείωσε το παιχνίδι (για τον προσδιορισμό του νικητή)
  - `filename`: Προαιρετικό προσαρμοσμένο όνομα αρχείου
- Επιστρέφει νωρίς με ένα μήνυμα σφάλματος αν δεν υπάρχουν κινήσεις για αποθήκευση

```python
# Αν δεν υφίστατι αρχείο, δημιουργία με βάση την τρέχουσα χρονική στιγμή
if filename is None:
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    filename = f"./game_history/chess_game_{timestamp}.txt"
```
- Αν δεν παρέχεται όνομα αρχείου, δημιουργεί αυτόματα ένα χρησιμοποιώντας την τρέχουσα ημερομηνία και ώρα
- Τοποθετεί τα αποθηκευμένα παιχνίδια σε έναν υποκατάλογο "game_history"
- Μορφή: "chess_game_YYYYMMDD_HHMMSS.txt"

```python
try:
    with open(filename, 'w') as f:
        # Εγγραφή κεφαλίδας
        f.write("Κινήσεις Σκακιού\n")
        f.write("===============\n\n")
        
        # Εγγραφή χρόνου και ημερομηνίας
        current_time = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        f.write(f"Το παιχνίδι πραγματοποιήθηκε την: {current_time}\n\n")
```
- Ανοίγει το αρχείο για εγγραφή (δημιουργώντας το αν δεν υπάρχει)
- Γράφει μια επικεφαλίδα στα Ελληνικά: "Κινήσεις Σκακιού" με μια γραμμή διαχωρισμού
- Καταγράφει την ημερομηνία και ώρα που αποθηκεύτηκε το παιχνίδι

```python
# Εγγραφή κινήσεων
f.write("Κινήσεις:\n")
for i, move in enumerate(moves_history):
    move_number = i // 2 + 1
    if i % 2 == 0:  # Λευκός παίκτης
        f.write(f"{move_number}. {move} ")
    else:  # Μαύρος παίκτης
        f.write(f"{move}\n")
```
- Γράφει τη λίστα των κινήσεων σε τυπική μορφή σημειογραφίας σκακιού:
  - Μορφοποιεί ως "1. e4 e5" όπου ο αριθμός είναι το ζεύγος κινήσεων
  - Οι κινήσεις του λευκού συνδυάζονται με τον αριθμό κίνησης
  - Οι κινήσεις του μαύρου ακολουθούν στην ίδια γραμμή
  - Κάθε πλήρες ζεύγος κινήσεων τελειώνει με μια νέα γραμμή

```python
# Προσθήκη κενής γραμμής αν ο τελευταίος παίκτης ήταν ο λευκός
if len(moves_history) % 2 == 1:
    f.write("\n")
```
- Προσθέτει μια νέα γραμμή αν το παιχνίδι τελείωσε μετά την κίνηση του λευκού (εξασφαλίζοντας σωστή μορφοποίηση)

```python
# Εμφάνιση αποτελέσματος όπου δύναται
if game_over:
    f.write("\nΑποτέλεσμα: ")
    if checkmate:
        winner = "Μαύρος" if turn == 'w' else "Λευκός"
        f.write(f"Ο {winner} παίκτης νίκησε!")
    else:
        f.write("Ισοπαλία!")
```
- Αν το παιχνίδι τελείωσε, προσθέτει το αποτέλεσμα στο αρχείο:
  - Για ρουά-ματ, προσδιορίζει και καταγράφει τον νικητή
  - Για πατ ή άλλους τερματισμούς χωρίς ρουά-ματ, καταγράφει ισοπαλία

```python
return f"Το ιστορικό του παιχνιδιού αποθηκεύτηκε με όνομα {filename}", True
except Exception as e:
    return f"Σφάλμα κατά την αποθήκευση: {str(e)}", False
```
- Επιστρέφει ένα μήνυμα επιτυχίας με το όνομα του αρχείου αν η αποθήκευση ήταν επιτυχής
- Συλλαμβάνει και χειρίζεται τυχόν εξαιρέσεις που εμφανίζονται κατά τη διαδικασία αποθήκευσης
- Επιστρέφει ένα μήνυμα σφάλματος και False αν η αποθήκευση απέτυχε